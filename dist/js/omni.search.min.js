/*
 *  omni-search - v0.0.1
 *  A UI element for global searches
 *  
 *
 *  Made by Pedro Catr√©
 *  Under MIT License
 */
!function(){"use strict";function a(a,b){this.element=a,this.settings=$.extend({},t,b),this._defaults=t,this._name=s,this.init()}function b(a){var b=$(q.SELECTED_SEARCH_RESULT_SELECTOR);if(0!==b.length){b.removeClass(q.SELECTED_CLASS);var c=null;if(a===o.GOING_DOWN){var d=b.next(q.SEARCH_RESULT_SELECTOR);c=0!==d.length?d:$(q.SEARCH_RESULT_SELECTOR).first()}else if(a===o.GOING_UP){var e=b.prev(q.SEARCH_RESULT_SELECTOR);c=0!==e.length?e:$(q.SEARCH_RESULT_SELECTOR).last()}d=c.addClass(q.SELECTED_CLASS)}else d=$(q.SEARCH_RESULT_SELECTOR).first().addClass(q.SELECTED_CLASS);d.get(0).scrollIntoViewIfNeeded()}function c(a){var b=d(a);$(q.SEARCH_RESULTS_LIST_SELECTOR).html(b),$(q.SEARCH_RESULT_SELECTOR).first().addClass(q.SELECTED_CLASS)}function d(a){var b=$("<span></span>");return a.forEach(function(a){var c=m.SEARCH_RESULT_ELEMENT_TEMPLATE,d=a.favIconUrl||q.DEFAULT_FAVICON;c=c.replace("{favicon}",d),c=c.replace("{default_favicon}",q.DEFAULT_FAVICON),c=c.replace("{title}",a.title);var e=$(c);e=e.data(a),b.append(e)}),b}function e(a){a=a.toLowerCase();var b=[],d="";r.map(function(c){d=JSON.stringify(c).toLowerCase(),d.match(a)&&b.push(c)}),c(b)}function f(a){switch(a){case n.UP_KEY:return o.GOING_UP;case n.DOWN_KEY:return o.GOING_DOWN;case n.ESCAPE_KEY:return o.ESCAPING;case n.ENTER_KEY:return o.SWITCHING;default:return!1}}function g(a){var b=a.data();"function"==typeof p&&p(b)}function h(){var a=$(q.OMNI_SEARCH_SELECTOR).find(q.SELECTED_SEARCH_RESULT_SELECTOR).first();g(a)}function i(a){var c=f(a.keyCode);switch(c){case o.GOING_UP:case o.GOING_DOWN:b(c);break;case o.ESCAPING:$(q.OMNI_SEARCH_SELECTOR).hide();break;case o.SWITCHING:h()}}function j(){$(q.OMNI_SEARCH_SELECTOR).hide(),$(q.SEARCH_INPUT_SELECTOR).val("")}function k(){$(document).on("mousedown",q.SEARCH_RESULT_SELECTOR,function(){var a=$(this);g(a)}),$(document).on("blur",q.SEARCH_INPUT_SELECTOR,function(){j()}),$(document).on("keydown",q.SEARCH_INPUT_SELECTOR,function(a){$(q.OMNI_SEARCH_SELECTOR).is(":visible")&&i(a)}),$(document).on("keyup",q.SEARCH_INPUT_SELECTOR,function(a){var b=a.keyCode,d=f(b);switch(d){case o.GOING_DOWN:case o.GOING_UP:case o.ESCAPING:case o.SWITCHING:return;default:var g=$(this).val();""!==$.trim(g)?e(g):c(r)}})}function l(a){return a.append(m.MAIN_TEMPLATE),a}var m;!function(a){a[a.MAIN_TEMPLATE='<div class="omni-search" style="display: none;">\n\t\t\t\t\t<input type="text">\n\t\t\t\t\t<ul class="search-results-list">\n\t\t\t\t\t</ul>\n\t\t\t\t</div>']="MAIN_TEMPLATE",a[a.SEARCH_RESULT_ELEMENT_TEMPLATE='<li class="search-result">\n\t\t\t\t\t<span class="favicon-img">\n\t\t\t\t\t<img src="{favicon}" onerror="this.src=\'{default_favicon}\';">\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class="title">{title}</span>\n\t\t\t\t</li>']="SEARCH_RESULT_ELEMENT_TEMPLATE"}(m||(m={}));var n;!function(a){a[a.DOWN_KEY=40]="DOWN_KEY",a[a.UP_KEY=38]="UP_KEY",a[a.ESCAPE_KEY=27]="ESCAPE_KEY",a[a.ENTER_KEY=13]="ENTER_KEY"}(n||(n={}));var o;!function(a){a[a.GOING_UP="going_up"]="GOING_UP",a[a.GOING_DOWN="going_down"]="GOING_DOWN",a[a.ESCAPING="escaping"]="ESCAPING",a[a.SWITCHING="switching"]="SWITCHING"}(o||(o={}));var p,q={DEFAULT_FAVICON:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAAMklEQVR4AWMgEkT9R4INWBUgKX0Q1YBXQYQCkhKEMDILogSnAhhEV4AGRqoCTEhkPAMAbO9DU+cdCDkAAAAASUVORK5CYII=",SELECTED_CLASS:"selected-search-result",SELECTED_SEARCH_RESULT_SELECTOR:".selected-search-result",FAVICON_IMG_SELECTOR:".favicon-img img",OMNI_SEARCH_SELECTOR:".omni-search",SEARCH_RESULTS_LIST_SELECTOR:".omni-search .search-results-list",SEARCH_RESULT_SELECTOR:".search-result",SEARCH_INPUT_SELECTOR:'.omni-search input[type="text"]'},r=[],s="omniSearch",t={propertyName:"value"};$.extend(a.prototype,{init:function(){var a=$(this.element);l(a),k()},open:function(a,b){console.log(">> Show omni search"),$(q.OMNI_SEARCH_SELECTOR).show(),$(q.SEARCH_INPUT_SELECTOR).focus(),r=a,p=b,c(a)},close:j}),$.fn[s]=function(b){var c=arguments;if(void 0===b||"object"==typeof b)return this.each(function(){$.data(this,"plugin_"+s)||$.data(this,"plugin_"+s,new a(this,b))});if("string"==typeof b&&"_"!==b[0]&&"init"!==b){var d;return this.each(function(){var e=$.data(this,"plugin_"+s);e instanceof a&&"function"==typeof e[b]&&(d=e[b].apply(e,Array.prototype.slice.call(c,1))),"destroy"===b&&$.data(this,"plugin_"+s,null)}),void 0!==d?d:this}}}();